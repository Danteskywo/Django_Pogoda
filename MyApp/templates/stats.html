<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .back-btn { display: inline-block; margin-bottom: 20px; padding: 10px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; }
        .stats-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total-stats { background: #f8f9fa; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <a href="/" class="back-btn" onclick="trackButtonClick('–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é')">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤</h1>
    
    <div class="total-stats">
        <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h2>
        <p><strong>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º:</strong> {{ total_clicks }}</p>
        <p><strong>–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> {{ total_actions }}</p>
        {% if most_popular %}
        <p><strong>–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –≥–æ—Ä–æ–¥:</strong> {{ most_popular.product_name }} ({{ most_popular.click_count }} –∫–ª–∏–∫–æ–≤)</p>
        {% endif %}
    </div>

    <div class="stats-section">
        <h2>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫:</h2>
        <table>
            <tr>
                <th>–ö–Ω–æ–ø–∫–∞/–î–µ–π—Å—Ç–≤–∏–µ</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤</th>
            </tr>
            {% for stat in button_stats %}
            <tr>
                <td>{{ stat.button_name }}</td>
                <td>{{ stat.count }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–∫–∞—Ö</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="stats-section">
        <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (20 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö):</h2>
        <table>
            <tr>
                <th>–í—Ä–µ–º—è</th>
                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                <th>–°—Ç—Ä–∞–Ω–∏—Ü–∞</th>
                <th>IP –∞–¥—Ä–µ—Å</th>
            </tr>
            {% for action in recent_actions %}
            <tr>
                <td>{{ action.click_time|date:"d.m.Y H:i:s" }}</td>
                <td>{{ action.button_name }}</td>
                <td>{{ action.page_url }}</td>
                <td>{{ action.ip_address }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="stats-section">
        <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ—Ä–æ–¥–∞–º:</h2>
        <table>
            <tr>
                <th>–ì–æ—Ä–æ–¥</th>
                <th>ID</th>
                <th>–ö–ª–∏–∫–æ–≤</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª–∏–∫</th>
            </tr>
            {% for stat in click_stats %}
            <tr>
                <td>{{ stat.product_name }}</td>
                <td>{{ stat.product_id }}</td>
                <td>{{ stat.click_count }}</td>
                <td>{{ stat.last_click|date:"d.m.Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–∫–∞—Ö –ø–æ –≥–æ—Ä–æ–¥–∞–º</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <script>
        function trackButtonClick(buttonName) {
            fetch('/track-click/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    button_name: buttonName
                })
            });
        }
    </script>
</body>
</html>